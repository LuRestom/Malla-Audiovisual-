<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tecnicatura Universitaria en ProducciÃ³n Audiovisual (UNCUYO) - Malla Interactiva</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --color1: #4acabb; /* aqua */
    --color2: #cbe5c0; /* light green */
    --color3: #fcf9c2; /* light yellow */
    --color4: #edc5bd; /* peach */
    --color5: #84407b; /* purple */
    --bg: #fffdfb;
    --card-shadow: 0 8px 20px rgba(0,0,0,0.06);
  }

  *{box-sizing:border-box}
  body{
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    margin:0;
    background: linear-gradient(180deg,var(--bg),#fff);
    color:#222;
    padding:18px;
  }

  header{ text-align:center; margin-bottom:14px; }
  header h1{ margin:0; color:var(--color5); font-size:22px; }
  header p{ margin:6px 0 0 0; color:#666; font-size:13px }

  .top-controls{ display:flex; gap:10px; justify-content:center; margin:14px 0 20px 0; flex-wrap:wrap }
  .btn{
    padding:8px 12px; border-radius:8px; border:0; cursor:pointer; font-weight:600;
    box-shadow:var(--card-shadow);
  }
  .btn.primary{ background:var(--color5); color:white }
  .btn.ghost{ background:#fff; border:1px solid #eee; color:#333 }

  .layout{
    display:grid;
    grid-template-columns: 1fr 320px;
    gap:18px;
    align-items:start;
  }

  /* Columnas por aÃ±o (verticales) - dentro del area principal */
  .years{
    display:flex;
    gap:14px;
    justify-content:center;
    align-items:flex-start;
    flex-wrap:nowrap;
    overflow-x:auto;
    padding-bottom:6px;
  }

  .year {
    width: 300px;
    background: linear-gradient(180deg,#fff, #fffaf8);
    border-radius:12px;
    padding:12px;
    box-shadow: var(--card-shadow);
    border-left:6px solid var(--color2);
  }

  .year h2{ margin:0 0 8px 0; font-size:18px; color:var(--color5); text-align:center }
  .block{
    margin-bottom:10px;
    padding:10px;
    border-radius:10px;
    background: rgba(255,255,255,0.9);
    border:1px solid #f4f4f4;
  }
  .block h3{ margin:0 0 8px 0; font-size:14px; color:#444; text-align:center }

  /* materia card */
  .subject{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    background:#fff;
    padding:8px 10px;
    border-radius:8px;
    margin:6px 0;
    border-left:6px solid var(--color1);
    box-shadow:0 3px 8px rgba(0,0,0,0.04);
    cursor:pointer;
    transition: transform .12s ease, opacity .12s ease, background .12s;
    position:relative;
    font-size:14px;
  }
  .subject .left{ display:flex; align-items:center; gap:10px; min-width:0 }
  .subject .dot{ width:10px; height:10px; border-radius:50%; background:var(--color1); flex:0 0 10px }
  .subject .title{ min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }

  .subject:hover{ transform:translateY(-3px) }

  /* DIFFERENT COLORS per block - soft */
  .year1 .block1 .subject{ border-left-color: var(--color1); background: linear-gradient(90deg,var(--color1), #fff); }
  .year1 .block2 .subject{ border-left-color: var(--color2); background: linear-gradient(90deg,var(--color2), #fff); }
  .year1 .blockA .subject{ border-left-color: var(--color3); background: linear-gradient(90deg,var(--color3), #fff); }

  .year2 .block1 .subject{ border-left-color: #9fe8bf; background: linear-gradient(90deg,#d9fbe6,#fff); }
  .year2 .block2 .subject{ border-left-color: #9fdcf2; background: linear-gradient(90deg,#e9fbff,#fff); }
  .year2 .blockA .subject{ border-left-color: #e6dbff; background: linear-gradient(90deg,#f6edff,#fff); }

  .year3 .block1 .subject{ border-left-color: var(--color4); background: linear-gradient(90deg,var(--color4), #fff); }

  /* bloqueada = transparent */
  .subject.bloqueada{
    opacity:0.2;
    cursor: default;
    filter: grayscale(0.15);
  }

  /* tooltip custom (para bloqueadas) */
  .subject.bloqueada[data-tooltip]:hover::after{
    content: attr(data-tooltip);
    position:absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: calc(100% + 12px);
    background: #222;
    color: #fff;
    font-size:13px;
    padding:8px 10px;
    border-radius:8px;
    white-space: pre-line;
    z-index:60;
    max-width:260px;
    text-align:left;
    box-shadow: 0 8px 26px rgba(0,0,0,0.2);
  }
  .subject.bloqueada[data-tooltip]:hover::before{
    content: "";
    position:absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: calc(100% + 6px);
    border:6px solid transparent;
    border-top-color:#222;
    z-index:61;
  }

  /* aprobada styles: tachado + difuminado */
  .subject.aprobada{
    text-decoration: line-through;
    opacity:0.45;
    background: linear-gradient(90deg,#f0fff0,#fff);
    border-left-color:#8be88b;
    cursor: default;
    pointer-events:none;
  }

  /* side panel for prereqs + practice */
  .side{
    background:#fff;
    padding:12px;
    border-radius:12px;
    box-shadow:var(--card-shadow);
    height:fit-content;
  }

  .side h3{ margin:0 0 8px 0; color:var(--color5) }
  .prereqs{ margin-bottom:12px; font-size:14px; color:#333 }
  .prereqs ul{ padding-left:18px; margin:8px 0 0 0; color:#444 }
  .prereqs li{ margin-bottom:6px }

  .progress-box{ margin-top:10px }
  .progress-label{ font-size:13px; color:#444; margin-bottom:6px }
  .progress-bar{ width:100%; height:16px; background:#f3f3f3; border-radius:8px; overflow:hidden; border:1px solid #eee }
  .progress-fill{ height:100%; background: linear-gradient(90deg,var(--color1),var(--color2)); width:0%; transition:width .4s ease }

  .hours-controls{ display:flex; gap:8px; margin-top:8px }
  .hours-controls input{ width:100px; padding:6px; border-radius:8px; border:1px solid #ddd }
  .hours-controls button{ padding:6px 8px; border-radius:8px; border:0; background:var(--color5); color:#fff; cursor:pointer }

  .congrats{
    margin-top:12px;
    padding:10px;
    border-radius:8px;
    background:linear-gradient(90deg,#fff7e6,#fff);
    border:1px solid #ffe8b3;
    color:#6b4a00;
    font-weight:600;
  }

  /* small helpers */
  .muted{ color:#666; font-size:13px }
  .small{ font-size:12px; color:#666 }

  /* responsive */
  @media (max-width:980px){
    .layout{ grid-template-columns: 1fr; }
    .years{ overflow-x:scroll; padding-bottom:12px }
  }
</style>
</head>
<body>
  <header>
    <h1>Tecnicatura Universitaria en ProducciÃ³n Audiovisual (UNCUYO)</h1>
    <p>Haz clic en una materia para marcarla como aprobada. Las materias dependientes aparecen transparentes hasta cumplir requisitos.</p>
  </header>

  <div class="top-controls">
    <button id="resetBtn" class="btn ghost">Reiniciar progreso</button>
    <button id="exportBtn" class="btn ghost">Exportar progreso</button>
    <button id="importBtn" class="btn ghost">Importar progreso</button>
  </div>

  <div class="layout">
    <main>
      <div class="years" id="yearsContainer" aria-live="polite">
        <!-- Years columns will be populated here -->
      </div>
    </main>

    <aside class="side" id="sidePanel" aria-live="polite">
      <h3>Detalle / Requisitos</h3>
      <div id="selectedTitle" class="muted">SeleccionÃ¡ una materia para ver sus requisitos</div>

      <div class="prereqs" id="prereqsBox" style="display:none">
        <div class="small">Requisitos pendientes:</div>
        <ul id="prereqList"></ul>
      </div>

      <div class="progress-box">
        <div class="progress-label">PrÃ¡cticas profesionales total acreditado <span id="hoursText" class="small"></span></div>
        <div class="progress-bar" title="Horas acreditadas">
          <div class="progress-fill" id="progressFill"></div>
        </div>

        <div style="display:flex; gap:8px; margin-top:10px; align-items:center;">
          <input id="hoursInput" type="number" placeholder="Agregar horas" min="1" />
          <button id="addHoursBtn" class="btn primary">Agregar</button>
        </div>
        <div class="small" style="margin-top:8px">Al alcanzar <b>260 hs</b> se desbloquea la materia <b>TIF</b>.</div>

        <div id="tifBox" style="margin-top:12px"></div>
      </div>

      <div id="graduationBox"></div>
    </aside>
  </div>

<script>
/* --- DATA: materia list + prereqs per your structure --- */

/*
We'll use ids (slug-like) and map to names + prereq ids.
'opensTIF' notation in your spec is omitted because TIF unlocking is driven by practice hours >= 260.
*/

const subjects = [
  // PRIMER AÃ‘O - 1Â° cuatri
  { id:"electricidad", name:"Electricidad y Mantenimiento", year:1, cuatri:1, prereq:[] },
  { id:"guion", name:"Guion", year:1, cuatri:1, prereq:[] },
  { id:"medios", name:"Medios de ComunicaciÃ³n y Cultura", year:1, cuatri:1, prereq:[] },

  // PRIMER AÃ‘O - 2Â° cuatri
  { id:"semiotica", name:"SemiÃ³tica", year:1, cuatri:2, prereq:["medios"] },
  { id:"arte_diseno", name:"Arte y DiseÃ±o Digital", year:1, cuatri:2, prereq:["guion"] },
  { id:"produccion_comunitaria", name:"ProducciÃ³n Comunitaria", year:1, cuatri:2, prereq:["guion","medios"] },
  { id:"produccion_televisiva", name:"ProducciÃ³n Televisiva", year:1, cuatri:2, prereq:["electricidad","guion"] },

  // PRIMER AÃ‘O - Anuales
  { id:"fotografia", name:"FotografÃ­a, IluminaciÃ³n y CÃ¡mara", year:1, cuatri:"A", prereq:[] },
  { id:"audiovisual_i", name:"Audiovisual I", year:1, cuatri:"A", prereq:[] },

  // PRACTICA 1 (handled as subject visually but hours shared)
  { id:"practica_1", name:"PrÃ¡ctica Profesional (1Â° aÃ±o)", year:1, cuatri:"A", prereq:[] , isPractice:true },

  // SEGUNDO AÃ‘O - 1Â° cuatri
  { id:"estetica", name:"EstÃ©tica Audiovisual", year:2, cuatri:1, prereq:["medios","semiotica"] },
  { id:"sonido", name:"Sonido", year:2, cuatri:1, prereq:["electricidad","guion"] },

  // SEGUNDO AÃ‘O - 2Â° cuatri
  { id:"derecho", name:"Derecho Audiovisual", year:2, cuatri:2, prereq:["produccion_televisiva","audiovisual_i","produccion_comunitaria","estetica"] },
  { id:"realizacion", name:"RealizaciÃ³n Audiovisual", year:2, cuatri:2, prereq:["fotografia","audiovisual_i","arte_diseno","produccion_televisiva"] },
  { id:"narrativa", name:"Narrativa Transmedia", year:2, cuatri:2, prereq:["arte_diseno","fotografia","audiovisual_i"] },

  // SEGUNDO AÃ‘O - Anuales
  { id:"edicion", name:"EdiciÃ³n", year:2, cuatri:"A", prereq:["arte_diseno","fotografia","produccion_televisiva"] },
  { id:"audiovisual_ii", name:"Audiovisual II", year:2, cuatri:"A", prereq:["audiovisual_i","fotografia","produccion_televisiva","produccion_comunitaria","semiotica"] },
  { id:"practica_2", name:"PrÃ¡ctica Profesional (2Â° aÃ±o)", year:2, cuatri:"A", prereq:[], isPractice:true },
  { id:"tpfinal2", name:"TP FINAL (2Â° aÃ±o)", year:2, cuatri:"A", prereq:[] },

  // TERCER AÃ‘O - 1Â° cuatri
  { id:"ingles", name:"InglÃ©s", year:3, cuatri:1, prereq:["narrativa","audiovisual_ii"] },
  { id:"direccion_arte", name:"DirecciÃ³n de arte y AmbientaciÃ³n", year:3, cuatri:1, prereq:["audiovisual_ii"] },
  { id:"electiva1", name:"Electiva I", year:3, cuatri:1, prereq:[] },
  { id:"electiva2", name:"Electiva II", year:3, cuatri:1, prereq:[] },
  { id:"audiovisual_iii", name:"Audiovisual III", year:3, cuatri:1, prereq:["sonido","edicion","derecho"] },
  { id:"practica_3", name:"PrÃ¡ctica Profesional (3Â° aÃ±o)", year:3, cuatri:1, prereq:[], isPractice:true },
  { id:"tpfinal3", name:"TP FINAL (3Â° aÃ±o)", year:3, cuatri:1, prereq:[] },

  // TIF (Trabajo Integrador Final) - desbloqueo por horas >= 260
  { id:"tif", name:"TIF (Trabajo Integrador Final)", year:2, cuatri:"A", prereq:[], isTIF:true }
];

/* localStorage keys */
const LS_APPROVED = "malla_uncuyo_approved_v1";
const LS_HOURS = "malla_uncuyo_practice_hours_v1";

/* load state */
let approved = JSON.parse(localStorage.getItem(LS_APPROVED)) || [];
let practiceHours = Number(localStorage.getItem(LS_HOURS)) || 0;

/* helpers */
function saveState(){
  localStorage.setItem(LS_APPROVED, JSON.stringify(approved));
  localStorage.setItem(LS_HOURS, String(practiceHours));
}

/* UI render */
const yearsContainer = document.getElementById("yearsContainer");
const sidePanelTitle = document.getElementById("selectedTitle");
const prereqList = document.getElementById("prereqList");
const prereqsBox = document.getElementById("prereqsBox");
const hoursText = document.getElementById("hoursText");
const progressFill = document.getElementById("progressFill");
const tifBox = document.getElementById("tifBox");
const graduationBox = document.getElementById("graduationBox");

function getSubject(id){ return subjects.find(s=>s.id===id); }

function unmetPrereqs(subject){
  const reqs = subject.prereq || [];
  return reqs.filter(r => !approved.includes(r));
}

function isUnlocked(subject){
  // Practice unlocks TIF specifically:
  if(subject.isTIF){
    return practiceHours >= 260;
  }
  // normal subjects unlocked if all prereqs approved
  const unmet = unmetPrereqs(subject);
  return unmet.length === 0;
}

function renderYears(){
  yearsContainer.innerHTML = "";
  [1,2,3].forEach(y=>{
    const col = document.createElement("div");
    col.className = `year year${y}`;
    col.innerHTML = `<h2>${y}Â° AÃ±o</h2>`;
    // blocks: cuatri1, cuatri2, anuales (A)
    const block1 = document.createElement("div"); block1.className="block block1";
    block1.innerHTML = `<h3>1Â° Cuatrimestre</h3>`;
    const block2 = document.createElement("div"); block2.className="block block2";
    block2.innerHTML = `<h3>2Â° Cuatrimestre</h3>`;
    const blockA = document.createElement("div"); blockA.className="block blockA";
    blockA.innerHTML = `<h3>Anuales</h3>`;

    subjects.filter(s=>s.year===y && s.cuatri===1).forEach(s => block1.appendChild(createSubjectNode(s)));
    subjects.filter(s=>s.year===y && s.cuatri===2).forEach(s => block2.appendChild(createSubjectNode(s)));
    subjects.filter(s=>s.year===y && (s.cuatri==="A" || s.cuatri==="a" || s.cuatri==="anual" || s.cuatri==="A")).forEach(s => blockA.appendChild(createSubjectNode(s)));

    col.appendChild(block1);
    col.appendChild(block2);
    col.appendChild(blockA);

    yearsContainer.appendChild(col);
  });

  // also render TIF somewhere visible in year 2 annuals area
  // ensure TIF node exists in its correct place via above loop (we placed it year:2 cuatri:A)
  renderSidePanel(null);
  updateProgressUI();
}

function createSubjectNode(s){
  const div = document.createElement("div");
  div.className = "subject";
  div.setAttribute("data-id", s.id);
  div.tabIndex = 0;

  const left = document.createElement("div"); left.className="left";
  const dot = document.createElement("div"); dot.className="dot";
  left.appendChild(dot);
  const title = document.createElement("div"); title.className="title";
  title.textContent = s.name;
  left.appendChild(title);

  const badge = document.createElement("div"); badge.className="small";

  div.appendChild(left);
  div.appendChild(badge);

  // state classes
  if(approved.includes(s.id)){
    div.classList.add("aprobada");
    badge.textContent = "âœ”";
  } else {
    if(!isUnlocked(s)){
      div.classList.add("bloqueada");
      const unmet = unmetPrereqs(s);
      let text = "Faltan: " + (unmet.length ? unmet.map(id=> getSubject(id)?.name || id).join("\\n") : "Prerrequisitos");
      // tooltip via data-tooltip
      div.setAttribute("data-tooltip", text);
      badge.textContent = "ðŸ”’";
    } else {
      badge.textContent = "";
    }
  }

  // click behavior
  div.addEventListener("click", (e)=>{
    // show side panel for this subject
    renderSidePanel(s.id);
    // if unlocked and not approved, approve on click
    if(!approved.includes(s.id) && isUnlocked(s)){
      // but for practice nodes (isPractice) we don't auto-approve; they track hours
      if(s.isPractice){
        // show side panel only
        return;
      }
      approved.push(s.id);
      saveState();
      renderYears();
    } else if(approved.includes(s.id)){
      // allow un-approve with confirmation (and cascade)
      if(confirm(`Â¿Desmarcar como aprobada "${s.name}"?\nSe desaprobarÃ¡n las materias que dependan de ella.`)){
        cascadeUnapprove(s.id);
        saveState();
        renderYears();
      }
    } else {
      // blocked click => just show prereqs
      // side panel already shown
    }
  });

  // keyboard support (Enter / Space)
  div.addEventListener("keydown", (ev)=>{
    if(ev.key === "Enter" || ev.key === " "){
      ev.preventDefault();
      div.click();
    }
  });

  return div;
}

/* cascade unapprove: desaprobar recursivamente */
function cascadeUnapprove(id){
  approved = approved.filter(x=>x!==id);
  // find dependents: subjects that have id in prereq
  subjects.forEach(s=>{
    if(s.prereq && s.prereq.includes(id)){
      if(approved.includes(s.id)) cascadeUnapprove(s.id);
    }
  });
}

/* --- Side panel logic --- */
function renderSidePanel(selectedId){
  if(!selectedId){
    sidePanelTitle.textContent = "SeleccionÃ¡ una materia para ver sus requisitos";
    prereqsBox.style.display = "none";
    return;
  }
  const s = getSubject(selectedId);
  sidePanelTitle.textContent = s.name;

  const unmet = unmetPrereqs(s);
  if(unmet.length > 0){
    prereqsBox.style.display = "block";
    prereqList.innerHTML = "";
    unmet.forEach(id=>{
      const li = document.createElement("li");
      li.textContent = getSubject(id)?.name || id;
      prereqList.appendChild(li);
    });
  } else {
    prereqsBox.style.display = "block";
    prereqList.innerHTML = "<li style='color:green'>No faltan prerequisitos</li>";
  }

  // Special display: if subject isTIF
  if(s.isTIF){
    tifBox.innerHTML = "";
    if(practiceHours < 260){
      const p = document.createElement("div");
      p.className = "small";
      p.textContent = "TIF se desbloquea al alcanzar 260 hs de prÃ¡ctica. Acreditadas: " + practiceHours + " hs.";
      tifBox.appendChild(p);
    } else {
      const p = document.createElement("div");
      p.className = "small";
      p.innerHTML = `<b>TIF desbloqueada</b> â€” ya podÃ©s cursarla/inscribirte.`;
      tifBox.appendChild(p);
      // if not approved yet, give button to marcar aprobada
      if(!approved.includes("tif")){
        const btn = document.createElement("button");
        btn.textContent = "Marcar TIF como aprobada";
        btn.className = "btn primary";
        btn.style.marginTop = "8px";
        btn.onclick = ()=>{
          approved.push("tif");
          saveState();
          renderYears();
          showGraduation();
        };
        tifBox.appendChild(btn);
      }
    }
  } else {
    // if the selected is not TIF, show nothing special (tifBox cleared)
    tifBox.innerHTML = "";
  }
}

/* --- Practice hours logic --- */
const hoursInput = document.getElementById("hoursInput");
const addHoursBtn = document.getElementById("addHoursBtn");

function updateProgressUI(){
  hoursText.textContent = `${practiceHours} / 260 hs`;
  const pct = Math.min(100, Math.round((practiceHours / 260) * 100));
  progressFill.style.width = pct + "%";

  // if reached 260 and tif not yet approved, show congratulations and unlock tif availability
  if(practiceHours >= 260){
    // reveal tif node visual change - rerender will handle isUnlocked
    const tifSubject = document.querySelector('[data-id="tif"]');
    if(tifSubject) tifSubject.classList.remove("bloqueada");
    // show small message in side panel if tif unlocked
    graduationBox.innerHTML = `<div class="congrats">Â¡Felicidades! Alcanzaste 260 hs. La materia <b>TIF</b> estÃ¡ ahora disponible.</div>`;
  } else {
    // hide congrat if any
    if(!approved.includes("tif")){
      graduationBox.innerHTML = "";
    }
  }
}

/* add hours button */
addHoursBtn.addEventListener("click", ()=>{
  const val = Number(hoursInput.value || 0);
  if(!val || val <= 0){ alert("Ingresa una cantidad de horas vÃ¡lida (>0)."); return; }
  practiceHours += val;
  if(practiceHours < 0) practiceHours = 0;
  saveState();
  hoursInput.value = "";
  renderYears();
});

/* show graduation when TIF approved */
function showGraduation(){
  if(approved.includes("tif")){
    document.getElementById("graduationBox").innerHTML = `<div class="congrats">Â¡Felicidades, te recibiste! ðŸŽ“<br>Ya sos Productor/ra Audiovisual.</div>`;
  }
}

/* export / import / reset */
document.getElementById("resetBtn").addEventListener("click", ()=>{
  if(confirm("Â¿Seguro que querÃ©s reiniciar todo el progreso y horas de prÃ¡ctica?")){
    approved = [];
    practiceHours = 0;
    saveState();
    renderYears();
    graduationBox.innerHTML = "";
  }
});

document.getElementById("exportBtn").addEventListener("click", async ()=>{
  const data = { approved, practiceHours };
  const json = JSON.stringify(data);
  try{
    await navigator.clipboard.writeText(json);
    alert("Progreso copiado al portapapeles (JSON).");
  }catch(e){
    prompt("Copia manualmente este JSON:", json);
  }
});

document.getElementById("importBtn").addEventListener("click", ()=>{
  const txt = prompt("Pega aquÃ­ el JSON exportado (ej: {\"approved\":[\"guion\"],\"practiceHours\":120})");
  if(!txt) return;
  try{
    const parsed = JSON.parse(txt);
    if(Array.isArray(parsed.approved) && typeof parsed.practiceHours === "number"){
      const ids = subjects.map(s=>s.id);
      const invalid = parsed.approved.filter(x=>!ids.includes(x));
      if(invalid.length){
        if(!confirm("Se encontraron IDs desconocidos: " + invalid.join(", ") + "\nSe ignorarÃ¡n.")) return;
      }
      approved = parsed.approved.filter(x=>ids.includes(x));
      practiceHours = parsed.practiceHours;
      saveState();
      renderYears();
      alert("Progreso importado.");
    } else {
      alert("JSON con formato invÃ¡lido.");
    }
  }catch(err){
    alert("JSON invÃ¡lido: " + err.message);
  }
});

/* initial render */
renderYears();
updateProgressUI();
showGraduation();

</script>
</body>
</html>
