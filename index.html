<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Malla — Tecnicatura en Producción Audiovisual (UNCUYO)</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --color1: #1c0b2b;
    --color2: #301c41;
    --color3: #413b6b;
    --color4: #5c65c0;
    --color5: #6f95ff;

    --soft-1: #3b2843; /* softer when approved */
    --soft-2: #4a3a63;
    --soft-3: #6b68a3;
    --soft-4: #8a93d6;
    --soft-5: #b7c9ff;

    --bg: #fbfcff;
    --card-shadow: 0 18px 40px rgba(43,54,74,0.06);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    background: linear-gradient(180deg,var(--bg),#ffffff);
    color:var(--color5);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
  }

  .container{ max-width:1240px; margin:0 auto; text-align:center; }

  header h1{ margin:0; font-size:34px; color:var(--color5); }
  header p{ margin:8px 0 0; color:#2b2b2b; font-size:16px }

  .top-links{ margin-top:8px; font-size:14px }
  .top-links a{ color:var(--color4); text-decoration:none; font-weight:600; }

  /* malla recuadros centrada */
  .malla-box{
    margin:22px auto;
    padding:18px;
    border-radius:16px;
    background:linear-gradient(180deg,#fff,#fffaf7);
    box-shadow:var(--card-shadow);
    display:flex;
    gap:20px;
    justify-content:center;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  .year{
    width:340px;
    background:linear-gradient(180deg,#ffffff,#fffefc);
    border-radius:12px;
    padding:16px;
    text-align:left;
    box-shadow:0 8px 26px rgba(0,0,0,0.04);
    flex:0 0 auto;
  }
  .year h2{ margin:0 0 10px; font-size:20px; color:var(--color4); text-align:center; }

  .block{ margin-bottom:12px; padding:8px 0; border-radius:10px; background:transparent; }
  .block h3{ margin:0 0 8px; font-size:16px; color:#333; text-align:center; }

  /* materia card: todas con color base var(--color3) y al aprobar -> soft */
  .subject{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:12px 14px; border-radius:10px; margin:8px 0;
    background: linear-gradient(90deg,var(--color3), #fff);
    border-left:8px solid var(--color4);
    cursor:pointer; transition: transform .12s ease, opacity .12s ease, box-shadow .12s ease, background .18s ease;
    font-size:18px; font-weight:700; color:var(--color5);
    position:relative;
  }
  .subject:hover{ transform:translateY(-4px); box-shadow:0 12px 30px rgba(0,0,0,0.06); }

  /* if you want year-specific tinting, you can change background by parent */
  .year1 .subject{ background: linear-gradient(90deg,var(--color1), #fff); border-left-color:var(--color4); }
  .year2 .subject{ background: linear-gradient(90deg,var(--color2), #fff); border-left-color:var(--color4); }
  .year3 .subject{ background: linear-gradient(90deg,var(--color3), #fff); border-left-color:var(--color4); }

  /* blocked: transparent */
  .subject.bloqueada{
    opacity:0.18; cursor:default; filter:grayscale(0.06); transform:none; box-shadow:none;
  }

  /* tooltip for blocked */
  .subject.bloqueada[data-tooltip]:hover::after{
    content: attr(data-tooltip);
    position:absolute;
    left:50%; transform:translateX(-50%);
    bottom:calc(100% + 10px);
    background:#111; color:#fff; padding:10px 12px; border-radius:8px;
    white-space:pre-line; z-index:80; max-width:320px; text-align:left; font-size:14px;
    box-shadow:0 12px 36px rgba(0,0,0,0.25);
  }
  .subject.bloqueada[data-tooltip]:hover::before{
    content:""; position:absolute; left:50%; transform:translateX(-50%);
    bottom:calc(100% + 4px); border:7px solid transparent; border-top-color:#111; z-index:81;
  }

  /* approved: softer color and strike */
  .subject.aprobada{
    text-decoration:line-through;
    opacity:0.65;
    pointer-events:none;
    background: linear-gradient(90deg,var(--soft-3), #fff);
    border-left-color: var(--soft-4);
    color:#ffffff;
  }

  /* practice box bottom */
  .practice-wrap{ display:flex; justify-content:center; margin-top:22px }
  .practice-box{
    width:920px; max-width:calc(100% - 40px); padding:16px; border-radius:12px;
    background:linear-gradient(180deg,#fff,#fffefc); box-shadow:var(--card-shadow); text-align:center;
  }
  .practice-title{ font-size:18px; color:var(--color5); margin:0 0 6px }

  .progress-bar{ width:100%; height:20px; background:#f3f3f3; border-radius:12px; overflow:hidden; border:1px solid #eee }
  .progress-fill{ height:100%; width:0%; background:linear-gradient(90deg,var(--color4),var(--color5)); transition:width .45s ease }

  .hours-controls{ display:flex; gap:10px; justify-content:center; align-items:center; margin-top:10px; flex-wrap:wrap }
  .hours-controls input{ padding:10px; width:160px; border-radius:10px; border:1px solid #e8e8e8; font-size:16px }
  .hours-controls button{ padding:10px 14px; border-radius:10px; border:0; background:var(--color5); color:#fff; font-weight:700; cursor:pointer }

  /* modal */
  .modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.45); z-index:200 }
  .modal-card{ background:#fff; padding:26px; border-radius:12px; width:92%; max-width:520px; text-align:center; box-shadow:0 26px 80px rgba(0,0,0,0.28) }
  .modal-card h2{ margin:0 0 10px; color:var(--color4); font-size:22px }
  .modal-card p{ margin:0 0 14px; color:#333; font-size:16px }
  .modal-card button{ padding:10px 14px; border-radius:10px; border:0; background:var(--color5); color:#fff; cursor:pointer; font-weight:700 }

  .controls { display:flex; gap:10px; justify-content:center; margin-top:10px; flex-wrap:wrap }

  @media (max-width:1100px){
    .malla-box{ flex-direction:column; align-items:center; gap:14px; padding-bottom:12px }
    .year{ width:92%; max-width:540px }
    .practice-box{ width:92% }
  }
  @media (max-width:520px){
    h1{ font-size:26px } .subject{ font-size:16px; padding:10px } .hours-controls input{ width:120px }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Malla — Tecnicatura Universitaria en Producción Audiovisual (UNCUYO)</h1>
      <p class="lead">Click en una materia para marcarla como aprobada. Materias dependientes aparecen transparentes hasta cumplir requisitos.</p>
      <div class="top-links"><a href="/mnt/data/Correlativas TUPA (1).pdf" target="_blank">Ver correlativas (PDF)</a></div>
    </header>

    <div class="malla-box" role="region" aria-label="Malla curricular">

      <!-- PRIMER AÑO -->
      <div class="year year1">
        <h2>PRIMER AÑO</h2>

        <div class="block">
          <h3>PRIMER CUATRIMESTRE</h3>
          <div class="subject" data-id="electricidad"><div class="title">Electricidad y Mantenimiento</div></div>
          <div class="subject" data-id="guion"><div class="title">Guion</div></div>
          <div class="subject" data-id="medios"><div class="title">Medios de Comunicación y Cultura</div></div>
        </div>

        <div class="block">
          <h3>SEGUNDO CUATRIMESTRE</h3>
          <div class="subject" data-id="semiotica"><div class="title">Semiótica</div></div>
          <div class="subject" data-id="arte_diseno"><div class="title">Arte y Diseño Digital</div></div>
          <div class="subject" data-id="produccion_comunitaria"><div class="title">Producción Comunitaria</div></div>
          <div class="subject" data-id="produccion_televisiva"><div class="title">Producción Televisiva</div></div>
          <div class="subject" data-id="fotografia"><div class="title">Fotografía, Iluminación y Cámara</div></div>
          <div class="subject" data-id="audiovisual_i"><div class="title">Audiovisual I</div></div>
        </div>
      </div>

      <!-- SEGUNDO AÑO -->
      <div class="year year2">
        <h2>SEGUNDO AÑO</h2>

        <div class="block">
          <h3>PRIMER CUATRIMESTRE</h3>
          <div class="subject" data-id="estetica"><div class="title">Estética Audiovisual</div></div>
          <div class="subject" data-id="sonido"><div class="title">Sonido</div></div>
        </div>

        <div class="block">
          <h3>SEGUNDO CUATRIMESTRE</h3>
          <div class="subject" data-id="derecho"><div class="title">Derecho Audiovisual</div></div>
          <div class="subject" data-id="realizacion"><div class="title">Realización Audiovisual</div></div>
          <div class="subject" data-id="narrativa"><div class="title">Narrativa Transmedia</div></div>
          <div class="subject" data-id="edicion"><div class="title">Edición</div></div>
          <div class="subject" data-id="audiovisual_ii"><div class="title">Audiovisual II</div></div>
          <div class="subject" data-id="tif"><div class="title">TIF (Trabajo Integrador Final)</div></div>
        </div>
      </div>

      <!-- TERCER AÑO -->
      <div class="year year3">
        <h2>TERCER AÑO</h2>

        <div class="block">
          <h3>PRIMER CUATRIMESTRE</h3>
          <div class="subject" data-id="ingles"><div class="title">Inglés</div></div>
          <div class="subject" data-id="direccion_arte"><div class="title">Dirección de arte y Ambientación</div></div>
          <div class="subject" data-id="electiva1"><div class="title">Electiva I</div></div>
          <div class="subject" data-id="electiva2"><div class="title">Electiva II</div></div>
          <div class="subject" data-id="audiovisual_iii"><div class="title">Audiovisual III</div></div>
        </div>

      </div>
    </div>

    <!-- practice box -->
    <div class="practice-wrap">
      <div class="practice-box" role="region" aria-label="Prácticas profesionales">
        <div class="practice-title">Prácticas Profesionales — acreditan <strong>260 hs</strong></div>
        <div class="small" style="margin-bottom:8px">Acumulá horas; al alcanzar 260 hs y aprobar las materias, se habilita TIF.</div>

        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width:0%"></div>
        </div>

        <div class="hours-controls" style="margin-top:12px">
          <input id="hoursInput" type="number" min="1" placeholder="Agregar horas..." />
          <button id="addHoursBtn">Agregar horas</button>
          <div id="hoursText" style="font-weight:700; color:var(--color5); margin-left:10px">0 / 260 hs</div>
        </div>

        <div class="controls" style="margin-top:12px">
          <button id="resetBtn" class="btn ghost">Reiniciar progreso</button>
          <button id="exportBtn" class="btn ghost">Exportar progreso</button>
          <button id="importBtn" class="btn ghost">Importar progreso</button>
        </div>
      </div>
    </div>
  </div>

  <!-- modal -->
  <div id="modal" class="modal" style="display:none">
    <div class="modal-card" role="dialog" aria-modal="true">
      <h2 id="modalTitle"></h2>
      <p id="modalText"></p>
      <button id="modalClose">Cerrar</button>
    </div>
  </div>

<script>
/* Prerrequisitos */
const prereqs = {
  "electricidad": [],
  "guion": [],
  "medios": [],
  "semiotica": ["medios"],
  "arte_diseno": ["guion"],
  "produccion_comunitaria": ["guion","medios"],
  "produccion_televisiva": ["electricidad","guion"],
  "fotografia": [],
  "audiovisual_i": [],
  "estetica": ["medios","semiotica"],
  "sonido": ["electricidad","guion"],
  "derecho": ["produccion_televisiva","audiovisual_i","produccion_comunitaria","estetica"],
  "realizacion": ["fotografia","audiovisual_i","arte_diseno","produccion_televisiva"],
  "narrativa": ["arte_diseno","fotografia","audiovisual_i"],
  "edicion": ["arte_diseno","fotografia","produccion_televisiva"],
  "audiovisual_ii": ["audiovisual_i","fotografia","produccion_televisiva","produccion_comunitaria","semiotica"],
  "ingles": ["narrativa","audiovisual_ii"],
  "direccion_arte": ["audiovisual_ii"],
  "electiva1": [],
  "electiva2": [],
  "audiovisual_iii": ["sonido","edicion","derecho"],
  "tif": []
};

const allSubjects = Object.keys(prereqs).filter(id=>id!=="tif");

/* localStorage keys */
const LS_APPROVED = "malla_uncuyo_v_colors_approved";
const LS_HOURS = "malla_uncuyo_v_colors_hours";

/* load state */
let approved = JSON.parse(localStorage.getItem(LS_APPROVED)) || [];
let hours = Number(localStorage.getItem(LS_HOURS)) || 0;

/* helpers */
function human(id){
  const map = {
    electricidad:"Electricidad y Mantenimiento", guion:"Guion", medios:"Medios de Comunicación y Cultura",
    semiotica:"Semiótica", arte_diseno:"Arte y Diseño Digital", produccion_comunitaria:"Producción Comunitaria",
    produccion_televisiva:"Producción Televisiva", fotografia:"Fotografía, Iluminación y Cámara", audiovisual_i:"Audiovisual I",
    estetica:"Estética Audiovisual", sonido:"Sonido", derecho:"Derecho Audiovisual", realizacion:"Realización Audiovisual",
    narrativa:"Narrativa Transmedia", edicion:"Edición", audiovisual_ii:"Audiovisual II", ingles:"Inglés",
    direccion_arte:"Dirección de arte y Ambientación", electiva1:"Electiva I", electiva2:"Electiva II", audiovisual_iii:"Audiovisual III",
    tif:"TIF (Trabajo Integrador Final)"
  };
  return map[id] || id;
}

function unmet(id){
  if(id==="tif"){
    const missing = allSubjects.filter(sid => !approved.includes(sid));
    const arr = [];
    if(hours < 260) arr.push("260 hs de prácticas");
    if(missing.length) arr.push("Aprobar todas las materias (faltan: " + missing.map(human).join(", ") + ")");
    return arr;
  }
  return (prereqs[id] || []).filter(r => !approved.includes(r)).map(human);
}

function unlocked(id){
  if(id==="tif"){
    return hours >= 260 && allSubjects.every(sid => approved.includes(sid));
  }
  return unmet(id).length === 0;
}

/* save */
function saveState(){ localStorage.setItem(LS_APPROVED, JSON.stringify(approved)); localStorage.setItem(LS_HOURS, String(hours)); }

/* render */
function renderAll(){
  document.querySelectorAll(".subject").forEach(el=>{
    const id = el.dataset.id;
    el.classList.remove("bloqueada","aprobada");
    el.removeAttribute("data-tooltip");
    if(approved.includes(id)){
      el.classList.add("aprobada");
    } else if(!unlocked(id)){
      el.classList.add("bloqueada");
      const list = unmet(id);
      el.setAttribute("data-tooltip", list.join("\n"));
    }
  });

  // progress UI
  const pct = Math.min(100, Math.round((hours/260)*100));
  document.getElementById("progressFill").style.width = pct + "%";
  document.getElementById("hoursText").textContent = hours + " / 260 hs";

  // year completion messages
  checkYearCompletion();

  // if tif approved
  if(approved.includes("tif")){
    showModal("¡Felicidades, te recibiste!", "Ya sos Productor/ra Audiovisual");
  }
}

/* attach behavior */
document.querySelectorAll(".subject").forEach(el=>{
  el.addEventListener("click", ()=>{
    const id = el.dataset.id;
    if(!unlocked(id)){
      el.focus();
      return;
    }
    if(!approved.includes(id)){
      approved.push(id);
      saveState();
      renderAll();
      return;
    } else {
      if(confirm(`¿Desmarcar como aprobada '${human(id)}'? Se desaprobarán las materias que dependan de ella.`)){
        cascadeUnapprove(id);
        saveState();
        renderAll();
      }
    }
  });
  el.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") { e.preventDefault(); el.click(); } });
});

/* cascade unapprove */
function cascadeUnapprove(id){
  approved = approved.filter(x=>x!==id);
  Object.keys(prereqs).forEach(k=>{
    if((prereqs[k]||[]).includes(id) && approved.includes(k)){
      cascadeUnapprove(k);
    }
  });
  // if tif now locked, remove
  if(approved.includes("tif") && !unlocked("tif")) approved = approved.filter(x=>x!=="tif");
}

/* hours controls */
document.getElementById("addHoursBtn").addEventListener("click", ()=>{
  const v = Number(document.getElementById("hoursInput").value || 0);
  if(!v || v<=0){ alert("Ingresá una cantidad de horas válida (>0)."); return; }
  hours += v;
  if(hours < 0) hours = 0;
  saveState();
  document.getElementById("hoursInput").value = "";
  renderAll();
});

/* export/import/reset */
document.getElementById("resetBtn").addEventListener("click", ()=>{
  if(confirm("¿Seguro que querés reiniciar todo el progreso (aprobadas y horas)?")){
    approved = []; hours = 0; saveState(); renderAll();
  }
});
document.getElementById("exportBtn").addEventListener("click", async ()=>{
  const data = { approved, hours }; const json = JSON.stringify(data);
  try{ await navigator.clipboard.writeText(json); alert("Progreso copiado al portapapeles."); }
  catch(e){ prompt("Copia manualmente este JSON:", json); }
});
document.getElementById("importBtn").addEventListener("click", ()=>{
  const txt = prompt("Pega aquí el JSON exportado (ej: {\"approved\":[\"guion\"],\"hours\":120})");
  if(!txt) return;
  try{
    const parsed = JSON.parse(txt);
    if(Array.isArray(parsed.approved) && typeof parsed.hours === "number"){
      const ids = Object.keys(prereqs).concat(["tif"]);
      const invalid = parsed.approved.filter(x=>!ids.includes(x));
      if(invalid.length){
        if(!confirm("Se encontraron IDs desconocidos: " + invalid.join(", ") + "\nSe ignorarán.")) return;
      }
      approved = parsed.approved.filter(x=>ids.includes(x));
      hours = parsed.hours; saveState(); renderAll(); alert("Progreso importado.");
    } else alert("JSON con formato inválido.");
  }catch(err){ alert("JSON inválido: " + err.message); }
});

/* modal */
function showModal(title,text){
  document.getElementById("modalTitle").textContent = title;
  document.getElementById("modalText").textContent = text;
  document.getElementById("modal").style.display = "flex";
}
document.getElementById("modalClose").addEventListener("click", ()=>{ document.getElementById("modal").style.display = "none"; });

/* year completion */
let shownY1=false, shownY2=false;
function checkYearCompletion(){
  const y1 = ["electricidad","guion","medios","semiotica","arte_diseno","produccion_comunitaria","produccion_televisiva","fotografia","audiovisual_i"];
  const y2 = ["estetica","sonido","derecho","realizacion","narrativa","edicion","audiovisual_ii"];
  const done1 = y1.every(id=> approved.includes(id));
  const done2 = y2.every(id=> approved.includes(id));
  if(done1 && !shownY1){ shownY1=true; showModal("Primer año adentro!","¡Vamos que falta poco!"); }
  if(done2 && !shownY2){ shownY2=true; showModal("Segundo año adentro!","¡El último esfuerzo, VOS PODÉS!"); }
  if(!done1) shownY1=false;
  if(!done2) shownY2=false;
}

/* init */
renderAll();
if(approved.includes("tif")) setTimeout(()=> showModal("¡Felicidades, te recibiste!","Ya sos Productor/ra Audiovisual"), 300);
</script>
</body>
</html>
